网络层能够被分解为两个相互作用的部分，即数据平面和控制平面。

## 4.1 网络层概述
每台路由器的数据平面的主要作用是从其输入链路向其输出链路转发数据报；
控制平面的主要作用是协调这些本地的每路由器转发动作，使得数据报沿着源和目的主机之间的路由器路径最终进行端到端传输。

### 4.1.1 转发和路由选择：数据平面和控制平面
网络层的作用从表面上看极为简单，即将分组从一台发送主机移动到一台接收主机。
为此，需要使用两种重要的网络层功能：
 - 转发。当一个分组到达某路由器的一条输入链路时，该路由器必须将该分组移动到适当的输出链路。
 - 路由选择。当分组从发送方流向接收方时，网络层必须决定这些分组所采用的路由或路径。计算这种路径的算法被称为路由选择算法（routing algorithm）。路由选择在网络层的控制平面中实现。

### 4.1.2 网络服务模型
**网络服务模型**（network service model）定义分组在发送与接收端系统之间的端到端运输特性。
英特网的网络层提供了单一的服务，称为**尽力而为服务**（best-effort service）


## 4.3 网际协议：IPv4、寻址、IPv6 及其他
### 4.3.1 IPv4数据报格式
![IPv4 datagram format.png](https://upload-images.jianshu.io/upload_images/3515839-9ffc176e18b60dd6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

### 4.3.2 IPv4数据报分片
一个链路层帧能承载的最大数据量叫做最大传送单元（Maximum Transmission Unit, MTU）。因为每个IP数据报封装在链路层帧中从一台路由器传输到下一台路由器，故链路层协议的MTU严格地限制着IP数据报的长度。

将IP数据报中的数据分片成两个或者更多较小的IP数据报，用单独的链路层帧封装这些较小的IP数据报，然后通过输出链路发送这些帧。每个这些较小的数据报都称为**片**（fragment）。

### 4.3.3 IPv4编址
一台主机通常只有一条链路连接到网络，当主机中的IP想要发送一个数据报时，它就在该链路上发送。主机与物理链路之间的边界叫做接口（interface）。
每个IP地址场地为32bit（等价为4byte），这些地址通常按**点分十进制**（dotted-decimal notation）书写，即地址中的每个字节用它的十进制形式书写，各字节以句点隔开。

### 4.3.4 网络地址转换
网络地址转换（Network Address Translation, NAT）使能路由器对应外界来说甚至不像一台路由器，相反NAT路由器对外界的行为就如同一个具有单一IP地址的单一设备。
### 4.3.5 IPv6
为了应对IPv4的32bit地址空间即将用尽的问题，开发了一种替代协议，即IPv6
![IPv6 datagram format.png](https://upload-images.jianshu.io/upload_images/3515839-90ef42578730b699.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
